<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <style>
      body {
        font-family: Helvetica, Arial, sans-serif
      }

      h1 {
        background-color: #2a5599;
        color: white;
        padding: 5px;
      }

      svg {
        border: 1px solid;
      }

      .mainView {
        display: flex;
      }
    </style>
    <script type="text/javascript" src="d3.js"></script>
  </head>

  <body>
    <h1>Airlines Routes</h1>
    <div class="mainView">
      <div>
        <h2>Airlines</h2>
        <svg id="AirlinesChart"></svg>
      </div>
      <div>
        <h2>Airports</h2>
        <svg id="Map"></svg>
      </div>
    </div>

    <!-- D3.js data manipulation. Must be after loading the page for performance reasons -->
    <script type="text/javascript">
      let store = {}

      function loadData() {
        let promise = d3.csv('routes.csv');
        return promise.then(routes => {
          store.routes = routes;
          return store;
        })
      }

      function groupByAirline(data) {
        let result = data.reduce((result, d) => {
          let currentData = result[d.AirlineID] || {
            "AirlineID": d.AirlineID,
            "AirlineName": d.AirlineName,
            "Count": 0
          };

          currentData.Count += 1;

          result[d.AirlineID] = currentData;

          return result;
        }, {})

        result = Object.keys(result).map(key => result[key]);
        result = result.sort((r1, r2) => d3.descending(r1.Count, r2.Count));
        return result;
      }

      function showData() {
        let routes = store.routes;
        let airlines = groupByAirline(store.routes);
        console.log(airlines);
      }

      loadData().then(showData);
    </script>
  </body>
</html>